<!--代码高亮-->
<script src="https://unpkg.com/prismjs@1.29.0/prism.js" defer></script>
<!--图标-->
<script src="https://unpkg.com/lucide@latest"></script>
<!--评论-->
<link rel="stylesheet"  href="https://unpkg.com/@waline/client@v3/dist/waline.css" />
<!-- Meta 图标 (可选) -->
<link rel="stylesheet" href="https://unpkg.com/@waline/client@v3/dist/waline-meta.css" />
<style>
    body {
        --font-ui-medium: 16px;
    }
    :root {       
        /* 字体大小 */
        --waline-font-size: 16px;

        /* 常规颜色 */
        --waline-white: #fff;
        --waline-light-grey: #999;
        --waline-dark-grey: #666;

        /* 主题色 */
        --waline-theme-color: #27ae60;
        --waline-active-color: #2ecc71;

        /* 布局颜色 */
        --waline-color: #444;
        --waline-bg-color: var(--background-primary-alt);
        --waline-bg-color-light: #f8f8f8;
        --waline-bg-color-hover: #f0f0f0;
        --waline-border-color: #ddd;
        --waline-disable-bg-color: #f8f8f8;
        --waline-disable-color: #bbb;
        --waline-code-bg-color: #282c34;

        /* 特殊颜色 */
        --waline-bq-color: #f0f0f0;

        /* 头像 */
        --waline-avatar-size: 3.25rem;
        --waline-m-avatar-size: calc(var(--waline-avatar-size) * 9 / 13);

        /* 徽章 */
        --waline-badge-color: #3498db;
        --waline-badge-font-size: 0.775em;

        /* 信息 */
        --waline-info-bg-color: #f8f8f8;
        --waline-info-color: #999;
        --waline-info-font-size: 0.625em;

        /* 渲染选择 */
        --waline-border: 1px solid var(--waline-border-color);
        --waline-avatar-radius: 50%;
        --waline-box-shadow: none;
    }

    /* 根据用户设置 ↓ */
    .waline-theme-dark {
        /* 常规颜色 */
        --waline-white: #000;
        --waline-light-grey: #666;
        --waline-dark-grey: #999;

        /* 布局颜色 */
        --waline-color: #888;
        --waline-bg-color: var(--background-primary-alt);
        --waline-bg-color-light: #272727;
        --waline-border-color: #333;
        --waline-disable-bg-color: #444;
        --waline-disable-color: #272727;

        /* 特殊颜色 */
        --waline-bq-color: #272727;

        /* 其他颜色 */
        --waline-info-bg-color: #272727;
        --waline-info-color: #666;
    }

    /* 去掉版权信息 */
    .wl-power {
        display: none;
    }

    /* 去掉用户名邮箱等信息 */
    .wl-header {
        /*display: none;*/
    }

    /* 调整文章反应样式 */
    .wl-reaction {
        margin-bottom: 1em;
        text-align: left;
        margin-left: 0.5em;
    }

    /* 文章反应标题边距 */
    .wl-reaction-title {
        margin: 20px auto;
    }

    .wl-reaction-list {
        justify-content: left;
    }

    .document-container>.markdown-preview-view>.markdown-preview-sizer {
        padding-bottom: 17px !important;
    }

    .wl-panel {
        margin: 0;
    }

    #waline {
        margin-top: 50px !important;
        max-width: 800px;
    }

    /* 左侧和右侧面板展开图标 */
    .clickable-icon.sidebar-collapse-icon {
        width: 2em !important;
        background-color: var(--background-secondary);
    }

    /* 链接图谱 */
    .graph-view-placeholder {
        width: 22%;
        margin-left: 38px;
    }

    /* 目录和大纲展开图标 */
    .tree-container .clickable-icon {
        margin-left: 2px;
        border-radius: 5px;
        border: none;
        box-shadow: none;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-top: -3px;
    }

    /* 文章最大宽度 */
    .document-container>.markdown-preview-view>.markdown-preview-sizer {
        max-width: 100vw !important;
    }

    /* 文章标题居中 */
    body.show-inline-title .page-title {
        text-align: center;
    }

    input[type="text"],
    textarea {
        font-size: 16px !important;
    }

    input[type=search] {
         width: 85%;
         border: 1px solid #888;
         border-radius: 5px;
         background-color:var(--background-primary);
         color: var(--text-muted);
    }

    .tree-container .clickable-icon {
        background-color: transparent;
    }

    body {
        user-select: unset;
    }

    blockquote{
        margin: 0;
    }

    #copyright {
        text-align: center;
        margin-top: 80px !important;
    }

    #copyright a {
        color: #ee802f;
        text-decoration: none;
        font-size: 15px;
        margin-left: 4px;
    }

    #copyright a img {
        width: 14px;
    }

    .document-container>.markdown-preview-view>.markdown-preview-sizer pre{
        overflow: auto;
    }

    .theme-light .document-container>.markdown-preview-view>.markdown-preview-sizer pre {
        position: relative;
        background-color: var(--background-primary-alt); /* #f6f6f6; */
        border: 1px solid #eeecec;
        border-radius: 5px;
        padding: 10px;
    }

    .theme-dark .document-container>.markdown-preview-view>.markdown-preview-sizer pre {
        position: relative;
        background-color: var(--background-primary-alt); /* #262626; */
        border: 1px solid #373838;
        border-radius: 5px;
        padding: 10px;
    }

    .markdown-rendered pre button.copy-code-button {
        position: absolute;
        top: 7px;
        right: 7px;
    }

    .wl-header input {
        font-size: 16px;
    }

    .wl-reaction-votes {
        text-align: center;
    }

    html>body>.webpage-container>.document-container>.markdown-preview-view>.markdown-preview-sizer>div.page-meta {
        text-align: center;
        padding: 10px !important;
    }

    .waline-comment-count,
    .waline-pageview-count,
    .page-ctime {
        margin-right: 35px;
    }

    .page-meta {
        color: #888;
    }

    .page-meta svg {
        width: 16px;
        vertical-align: middle;
    }

    #qrcode {
        position: relative;
    }

    #qr-zoom {
        position: absolute;
        width: 170px;
        height: 200px;
        z-index: 999;
        display: none;
        border: 1px solid #ccc;
        background: #fff;
    }

    #qrcode:hover #qr-zoom {
        display: inline-block;
    }

    #qr-zoom img {
        margin-top: 10px;
    }

    #qr-zoom font {
        margin-top: 4px;
        display: inline-block;
    }

    @media (max-width: 768px) {
        #qrcode {
            display: none !important;
        }
    }

    #scrollToTopBtn {
        display: none;
        position: fixed;
        width: 46px;
        height: 46px;
        border: 1px solid #ddd;
        border-radius: 5px;
        background-color: var(--background-primary);
        text-align: center;
        bottom: 75px;
        right: 306px;
        opacity: 0.8;
    }

    #scrollToTopBtn:hover {
        background-color: var(--background-primary-alt);
    }

    #scrollToTopBtn svg {
        margin-top: 11px;
        color: var(--text-normal);
    }

    #scrollToTopBtn.st-collapsed {
        right: 30px;
    }

    @media (max-width: 768px) {
        #scrollToTopBtn {
            right: 12px;
        }

        #scrollToTopBtn.st-collapsed {
            right: 12px;
        }
    }

   .theme-dark #scrollToTopBtn {
       border: 1px solid #999;
   }
  .markdown-rendered pre button.copy-code-button{
      background-color: var(--background-primary);
      padding: 3px 6px;
      border: 1px solid #888;
      border-radius: 5px;
      opacity: 0.9;
  }
  .document-container.markdown-reading-view{
      background-color: var(--background-primary);
  }

  table {
    border: 1px solid var(--table-border-color);
    border-radius: var(--size-2-3);
    border-spacing: 0;
  }
  th, td {
      padding: 10px;
      border-right: 1px solid var(--table-border-color);
      border-bottom: 1px solid var(--table-border-color);
  }
  th:last-child, td:last-child {
      border-right: 0;
  }

  /* 兼容有thead的情况 */
  tr:last-child:not(:only-child) th, tr:last-child td{
      border-bottom: 0;
  }
  table > :only-child th{
      border-bottom: 0;
  }
  /* 兼容有thead的情况 end */

  .document-container>.markdown-preview-view{
      margin: 0;
      padding: var(--sidebar-margin);
  }
  .sidebar-content{
    background-color: var(--background-primary-alt);
  }
  .nav-folder-title[data-count]::after {
    content: attr(data-count);
    font-size: calc(100% * 0.8);
    margin-right: 12px;
  }
  .tree-container .tree-header {
      width: 100%;
  }
  #total-files {
    position: absolute;
    right: 12px;
    color: var(--nav-item-color);
    font-size: calc(100% * .8);
  }
  .tree-container .collapse-icon {
    display: flex;
    align-items: center;
  }
  /* 附件下载 */
  .internal-embed.file-embed {
      cursor: pointer;
  }
  .sidebar-content{
      padding-left: 0;
      padding-right: 0;
  }
  .search-input-container {
      padding-left: 10px;
  }
  .tree-container{
      padding-left: 12px;
      padding-right: 12px;
  }
  .graph-view-wrapper {
      padding-left: 12px;
      padding-right: 12px;
  }
  body .webpage-container .tree-container .tree-scroll-area, .tree-container .tree-header {
      width: calc(100% - 12px);
  }
  .tree-container .clickable-icon svg {
      width: 18px;
  }
  ul.dataview.list-view-ul li {
      line-height: 180%;
  }
  #webpage-icon{
      display: none;
  }
  .markdown-reading-view table {
      margin-block-start: var(--p-spacing);
      margin-block-end: var(--p-spacing);
  }
  li {
    line-height: 180%;
  }
</style>
<!------------------------------------------------->
<script type="module">
    import { init } from 'https://unpkg.com/@waline/client@v3/dist/waline.js';
    window.initWaline = (transferDocument) => {
        transferDocument = transferDocument || document;
        const path = location.pathname.replace(/index\.html$/, '').replace(/\/$/, '') || '/';
        const waline = document.querySelector("#waline");
        const container = document.querySelector(".markdown-preview-sizer")
        if (!waline) {
            const waline = document.createElement("div");
            waline.id = "waline";
            if(!SHOW_COMMENTS) waline.style.display = 'none';
            container.appendChild(waline);
        }
        let pageMeta = document.querySelector('.page-meta');
        if (!pageMeta) {
            const pageTitleElement = document.querySelector('.page-title');
            pageMeta = document.createElement('div');
            pageMeta.className = "page-meta";
            if(!SHOW_PAGE_HEADER) pageMeta.style.display = 'none';
            const ctime = transferDocument.querySelector('meta[name="ctime"]')?.getAttribute("content") || '';
            let pageMetaHTML = '<span title="创建时间"><i data-lucide="clock"></i> <span class="page-ctime">' + timestampToTimeString(+ctime) + '</span></span> ';
            if(SHOW_COMMENTS) pageMetaHTML += '<span title="评论量"><i data-lucide="message-circle-more"></i> <span class="waline-comment-count" data-path="' + path + '">0</span></span> ';
            pageMetaHTML += '<span title="阅读量"><i data-lucide="eye"></i> <span class="waline-pageview-count" data-path="' + path + '">1</span></span> ';
            pageMetaHTML += '<span id="qrcode" title="手机查看"><i data-lucide="qr-code"></i><span id="qr-zoom"><img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=' + encodeURIComponent(location.href) + '" /><br /><font>手机查看</font></span></span>';
            pageMeta.innerHTML = pageMetaHTML;
            pageTitleElement.after(pageMeta);
            lucide.createIcons();
        }
        try {
            if(SHOW_PAGE_HEADER || SHOW_COMMENTS) {
                init({
                    el: '#waline',
                    // 文章反应
                    reaction: true,
                    dark: false,
                    copyright: false,
                    // 浏览量统计
                    pageview: true,
                    // 评论数统计
                    comment: true,
                    path: path,
                    serverURL: WALINE_SERVER_URL || '',
                    locale: {
                        reaction0: '点赞',
                        reaction1: '踩一下',
                        reaction2: '酷毙了',
                        reaction3: '不屑',
                        reaction4: '尴尬',
                        reaction5: '无聊',
                    },
                });
            }
        } catch (e) {
            console.log(e);
        }
        //创建scroll to top
        if (SHOW_SCROLL_TO_TOP && !document.getElementById('scrollToTop')) {
            const scrollToTop = document.createElement("div");
            scrollToTop.id = "scrollToTop";
            scrollToTop.innerHTML = '<div id="scrollToTopBtn"><i data-lucide="arrow-up-to-line"></i></div>';
            container.appendChild(scrollToTop);
            lucide.createIcons();

            var targetElement = document.querySelector(".document-container>.markdown-preview-view");
            var scrollToTopBtn = document.getElementById('scrollToTopBtn');

            // 监听滚动事件
            targetElement.addEventListener('scroll', function () {
                var scrollTop = targetElement.scrollTop;
                var threshold = targetElement.clientHeight * 0.25; // 当滚动超过25%时显示按钮

                if (scrollTop > threshold) {
                    scrollToTopBtn.style.display = 'block'; // 显示回到顶部按钮
                } else {
                    scrollToTopBtn.style.display = 'none'; // 隐藏回到顶部按钮
                }
            });

            // 为回到顶部按钮绑定点击事件
            scrollToTopBtn.addEventListener('click', function () {
                var targetElement = document.querySelector(".document-container>.markdown-preview-view");

                if ('scrollBehavior' in document.documentElement.style) {
                    targetElement.scrollTo({
                        top: 0,
                        behavior: 'smooth'
                    });
                } else {
                    targetElement.scrollTop = 0;
                }
            });

            onToggleCollapsedChangedToTop();
            const rightCollapse = document.querySelector(".sidebar-right .clickable-icon.sidebar-collapse-icon")
            rightCollapse.addEventListener('click', () => {
                setTimeout(() => {
                    onToggleCollapsedChangedToTop();
                }, 42)
            })
        }
        // 代码复制按钮
        document.querySelectorAll(".document-container>.markdown-preview-view>.markdown-preview-sizer pre").forEach((pre) => {
            pre.addEventListener('scroll', () => {
                const copyCodeBtn = pre.querySelector('.copy-code-button');
                const copyCodeBtnRect = copyCodeBtn.getBoundingClientRect();
                copyCodeBtn.style.right = 'auto';
                copyCodeBtn.style.left = (pre.scrollLeft + pre.offsetWidth - copyCodeBtnRect.width - 8) + 'px';
            })
        });

        // 评论提交后执行
        setTimeout(() => {
            if(!SHOW_COMMENTS) return;
            const countElement = document.querySelector('.wl-count');
            // 创建一个观察器实例
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.type === 'characterData' || mutation.type === 'childList') {
                        if(mutation.target.firstChild){
                            document.querySelector(".waline-comment-count").innerHTML = mutation.target.firstChild.textContent;
                        }
                    }
                });
            });
            // 配置观察器选项
            const config = { attributes: false, childList: true, subtree: true, characterData: true };
            // 观察指定元素
            observer.observe(countElement, config);
        }, 100);

    }
</script>
<script>
    // 切换文章时执行
    function onAsyncLoadedDocument(url, transferDocument) {
        togglePrismTheme(localStorage.getItem("theme") === 'dark' ? false : true);
        // 图片显示兼容
        setTimeout(() => {
            loadSpecialImg();
        }, 42);
        // 初始化评论
        initWaline(transferDocument);
        // 生成版权信息
        copyright()
        // 图片放大
        initImgZoom();
        // 添加文件下载按钮
        attachDownload();
    }
    // 动态切换样式 state ? "light" : "dark"
    function toggleWalineTheme(state) {
        if (state || document.body.classList.contains("waline-theme-dark")) {
            document.body.classList.remove("waline-theme-dark")
        } else {
            document.body.classList.add("waline-theme-dark")
        }
    }
    // 切换主题样式时执行 state ? "light" : "dark"
    function onThemeToggle(state) {
        toggleWalineTheme(state)
        togglePrismTheme(state);
    }
    // 侧边栏折叠时执行
    function onSidebarCollapsed(collapsed, deviceSize, sidebar) {
        const isLeftSidebar = sidebar.classList.contains("sidebar-left");
        const isFloatingSidebars = document.body.classList.contains("floating-sidebars")

        // 触发侧边栏时改变scroll to top位置
        onToggleCollapsedChangedToTop();

        //console.log(collapsed, deviceSize, isFloatingSidebars, 'sidebar');
        if(isFloatingSidebars) {
            const sidebarMask = document.querySelector("#sidebarMask");
            const treeArea = document.querySelector(".sidebar-left .tree-scroll-area");
            const isPhone = isMobile();
            if(collapsed) {
                //折叠侧边栏
                if(sidebarMask) sidebarMask.style.display = 'none';
                if(isLeftSidebar && treeArea && isPhone) treeArea.style.display = 'none';
            } else {
                //展开侧边栏
                if(sidebarMask) sidebarMask.style.display = 'block';
                if(isLeftSidebar && treeArea && isPhone) {
                    setTimeout(()=>{treeArea.style.display = 'block';}, 100);
                }
            }
        }
    }

    // 侧边栏折叠时触发scroll to top
    function onToggleCollapsedChangedToTop() {
        if(typeof scrollToTopBtn !== 'undefined'){
            const sidebarRight = document.querySelector(".sidebar-right")
            if (sidebarRight.classList.contains('is-collapsed')) {
                scrollToTopBtn.classList.add('st-collapsed')
            } else {
                scrollToTopBtn.classList.remove('st-collapsed')
            }
        }
    }

    function copyright() {
        const year = new Date().getFullYear();
        const author = AUTHOR || document.querySelector('meta[name="author"]')?.getAttribute("content") || VAULT_TITLE;
        let copytext = '© ' + year + ' '+ author + ' <font color="#ee802f">♡</font> 由obsidian强力驱动'
        if(SHOW_RSS_FEED) copytext += '&nbsp;<a href="lib/rss.xml"><img src="https://s21.ax1x.com/2024/04/21/pkpNoSf.png" />RSS</a>';
        const container = document.querySelector(".markdown-preview-sizer")
        const copyright = document.createElement("div");
        copyright.id = "copyright";
        if(!SHOW_PAGE_FOOTER) copyright.style.display = 'none';
        copyright.innerHTML = copytext;
        container.appendChild(copyright);
    }
    function timestampToTimeString(timestamp) {
        timestamp = timestamp ? timestamp : null;
        //时间戳为10位需*1000，时间戳为13位的话不需乘1000
        let date = new Date(timestamp);
        let Y = date.getFullYear() + '-';
        let M = (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1) + '-';
        let D = (date.getDate() < 10 ? '0' + date.getDate() : date.getDate()) + ' ';
        return Y + M + D;
    }
    // state ? "light" : "dark"
    function togglePrismTheme(state) {
        const themeTail = state ? "" : "-dark";
        const currLink = document.getElementById("prism-theme");
        const linkHref = 'https://unpkg.com/prismjs@1.29.0/themes/prism' + themeTail + '.min.css';
        if (currLink && currLink.href === linkHref) return;
        const link = document.createElement('link');
        link.id = 'prism-theme';
        link.rel = 'stylesheet';
        link.href = linkHref;
        link.onload = () => { if (currLink) currLink.remove(); }
        document.head.appendChild(link);
    }
    togglePrismTheme(localStorage.getItem("theme") === 'dark' ? false : true);
    function onDomReady(fn) {
        if (document.readyState !== 'loading') {
            fn();
        } else {
            document.addEventListener('DOMContentLoaded', fn);
        }
    }
    function isMobileMedia(maxWidth=768) {
        return window.matchMedia("(max-width: "+maxWidth+"px)").matches;
    }
    //初始化图片放大
    function initImgZoom() {
        ImgZoom(".document-container>.markdown-preview-view>.markdown-preview-sizer > div:not(.page-meta,.mod-footer,#waline,#scrollToTop,#copyright) img");
    }
    // 搜索时执行
    function onSearch() {
        const searchInput = document.querySelector(".sidebar-left input[type=search]");
        searchInput.addEventListener("input", (e) => {
            setTimeout(()=>setTreeCount(), 42);
        });
    }
    // 获取目录树文章数
    function setTreeCount() {
        // 获取总数
        const total = document.querySelector(".sidebar-left .file-tree").querySelectorAll(".nav-file:not(.filtered-out)").length;
        if(!document.querySelector("#total-files")){
            const treeHeader = document.querySelector(".tree-container .tree-header")
            const totalSpan = document.createElement("span");
            totalSpan.id = "total-files";
            totalSpan.innerHTML = total;
            treeHeader.appendChild(totalSpan);
        } else {
            document.querySelector("#total-files").innerHTML = total;
        }

        // 获取每个目录的文章数
        const allFolders = document.querySelectorAll(".sidebar-left .file-tree .nav-folder:not(.filtered-out) .tree-link .nav-folder-title");
        allFolders.forEach(folder => {
            const fileCount = folder.parentElement.nextElementSibling.querySelectorAll(".nav-file:not(.filtered-out)").length;
            folder.dataset.count = fileCount;
        });
    }
    // 文件树尺寸变化时执行
    function observeTreeAreaResize() {
        // 监听出现滚动条
        const elementToObserve = document.querySelector('.webpage-container .tree-container .tree-scroll-area');
        const resizeObserver = new ResizeObserver(()=>{
            document.querySelector("#total-files").style.right = (elementToObserve.offsetWidth - elementToObserve.clientWidth + 12) + 'px';
        });
        resizeObserver.observe(elementToObserve);
    }
    // 当全文检索开始建立索引时执行
    function onSearchIndexing() {
        const searchInput = document.querySelector(".sidebar-left input[type=search]");
        searchInput.placeholder = LANG === 'zh-cn' ? '正在建立全文索引...' : 'Full-text indexing...';
    }
    // 当全文检索准备好后执行
    function onSearchReady() {
        const searchInput = document.querySelector(".sidebar-left input[type=search]");
        searchInput.placeholder='Search...';
    }
    // 图片显示兼容
    function loadSpecialImg() {
        document.querySelectorAll("img[src*='+']").forEach(item => {
            item.setAttribute('src', URLencode(item.getAttribute('src')));
        });
    }
    // 添加附件下载按钮
    function attachDownload() {
        setTimeout(() => {
            document.querySelectorAll(`.internal-embed.file-embed`).forEach((item)=>{
                item.onclick=()=>{
                    window.open(item.getAttribute('src'));
                }
            });
        }, 42);
    }
    // 当滚动完成时执行
    function onScrollIntoViewStart(element, options, animate) {
        // 解决手机出现横向滚动条问题
        setTimeout(()=>{
            const pageView = document.querySelector(".document-container>.markdown-preview-view");
            if(pageView.scrollLeft > 0) pageView.scrollTo(0, pageView.scrollTop);
        }, 1500)
    }
    // 文章加载完成后执行
    onDomReady(() => {

        // 将index.html的标题改为首页
        let elapsedTime = 0;
        const waitForIndexTitle = (delay = 50) => {
            const indexTitle = document.querySelector(
                ".mod-tree-file .tree-link[href='index.html'] .tree-item-title"
            );
            if (elapsedTime > 60000) {
                return;
            }
            if (indexTitle && indexTitle.innerHTML === 'index') {
                indexTitle.innerHTML = '首页';

                // 图片显示兼容
                loadSpecialImg();

                return;
            }
            elapsedTime += delay;
            setTimeout(() => {
                waitForIndexTitle(delay);
            }, delay);
        };

        // 修改首页标题
        if (LANG === 'zh-cn') waitForIndexTitle();
        // 初始化评论
        initWaline();
        // 触发评论样式切换
        toggleWalineTheme(localStorage.getItem("theme") === 'dark' ? false : true);
        // 生成版权信息
        copyright()

       // dom ready时显示内容
       document.querySelector(".document-container").classList.remove('hide');
      // 自动展开当前文档的树形菜单
      const navTimer = setInterval(()=>{
        const activeNavItem = document.querySelector(".nav-file.mod-active");
        if(activeNavItem && activeNavItem.parentElement) {
          if(navTimer) clearInterval(navTimer);
          //if(activeNavItem.parentElement.style.display === 'none'){
          //  setTimeout(() => {
          //    activeNavItem.parentElement.previousElementSibling.click();
          //  }, 42);
          //}
          setTimeout(()=>{
            // 兼容不支持translate的浏览器
            setTimeout(()=> {
                const collapseIcons = document.querySelectorAll(".tree-container .collapse-icon");
                if(collapseIcons.length >0 && collapseIcons[0].style.translate  === undefined){
                    collapseIcons.forEach(item=>{item.style.left=0})
                }
            }, 50);

            if (SHOW_FILE_NUMBER) {
                // 计算数目录文件数
                setTreeCount();
                // 文件树尺寸变化时执行
                observeTreeAreaResize();
                // 搜索时执行
                onSearch();
            }

            // 支持file color插件 (也可通过生成css文件实现)
            if (FILE_COLORS && USE_FILE_COLOR_PLUGIN && Object.getOwnPropertyNames(FILE_COLORS).length) {
                for(const key in FILE_COLORS) {
                    const link = document.querySelector(".sidebar-left .tree-link[data-path='"+key+"'] .tree-item-title");
                    if(link) link.style.color = FILE_COLORS[key];
                }
            }

            // 添加文件下载按钮
            attachDownload();

          }, 42);
        }
      }, 50);

      // 创建小屏侧边栏展开遮罩层，防止误触其他元素
      const sidebarMask = document.createElement("div");
      sidebarMask.id = "sidebarMask";
      sidebarMask.style = "position:fixed;top:0;left:0;opacity:0;z-index:9;width:100%;height:100%;display:none;";
      sidebarMask.onclick = function() {this.style.display = 'none';}
      document.body.appendChild(sidebarMask);

      // 图片放大缩小
      initImgZoom();

      //搜索事件
      document.querySelector(".webpage-container input[type=search]").addEventListener("input", (e) => {
        if(!searchReady){
            if(EasyNotice) EasyNotice.createNotice(LANG === 'zh-cn' ? '正在建立全文索引，请稍后重试...' : 'Full-text indexing, please try again later.', 1500, 'left:12px;top:12px;', true, false);
        }
      });

    });
</script>